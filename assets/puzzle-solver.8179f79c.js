var U=Object.defineProperty;var y=(r,l,i)=>l in r?U(r,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[l]=i;var N=(r,l,i)=>(y(r,typeof l!="symbol"?l+"":l,i),i);let B=0;if(!document.getElementById("puzzle-resolver-style")&&location.href.includes("auto_resolve_hightlight=1")){const r=document.createElement("style");r.id="puzzle-resolver-style",r.innerText=".puzzle-resolver-target {background-color:#5daef4!important}",document.head.appendChild(r)}async function V(r){if(B==1){console.log("Stopped. An error will throw soon."),B=0;return}B=1;const l=isNaN(Number(r))?500:Number(r),i=[c.TOP,c.NEXT_TO_TOP,c.CENTER,c.NEXT_TO_BOTTOM,c.BOTTOM],u=[c.LEFT,c.NEXT_TO_LEFT,c.CENTER,c.NEXT_TO_RIGHT,c.RIGHT],E=[c.TOP_LEFT,c.NEXT_TO_LEFT,c.LEFT,c.BOTTOM_LEFT],F=[c.TOP_RIGHT,c.NEXT_TO_RIGHT,c.RIGHT,c.BOTTOM_RIGHT],C=[c.TOP_LEFT,c.NEXT_TO_TOP,c.TOP,c.TOP_RIGHT],k=[c.BOTTOM_LEFT,c.NEXT_TO_BOTTOM,c.BOTTOM,c.BOTTOM_RIGHT],D=document.querySelector(".game-container"),v=new b(parseInt(D.dataset.rows)+1,parseInt(D.dataset.cols)),I=A(v),w=Array.from(document.querySelectorAll(".block:not(.wall)")).map(o=>M.fromEl(o));if(w.forEach(o=>{const[s,n]=q(o.value,v.cols);o.setCorrectPosition(s,n),I[o.row][o.col]=o}),w.filter(o=>!o.isCorrect).length==0){console.log("All block is correct. Stop."),B=0;return}let S=Date.now();console.clear(),console.log("Resolving...");const R=w.find(o=>o.value==0);let d=null,p={};for(let o=v.rows-1;o>2;o--){let s=function(){return n.isCorrect&&t.isCorrect};for(let T=v.cols-1;T>=2;T--){const f=w.find(h=>h.correctRow==o&&h.correctCol==T);console.log(`Moving ${f.value} to ${[f.correctRow,f.correctCol]}`),await a(f,[f.correctRow,f.correctCol]),f.markFrezee()}const n=w.find(T=>T.correctRow==o&&T.correctCol==0),t=w.find(T=>T.correctRow==o&&T.correctCol==1);await a(n,[t.correctRow,t.correctCol],s),n.markFrezee(),await a(t,[t.correctRow-1,t.correctCol],s)||(n.unFrezee(),await a(t,[t.correctRow-2,t.correctCol]),t.markFrezee(),await a(n,[t.correctRow,t.correctCol]),n.markFrezee(),t.unFrezee(),await a(t,[t.correctRow-1,t.correctCol])),t.markFrezee(),n.unFrezee(),await a(n,[n.correctRow,n.correctCol]),n.markFrezee(),t.unFrezee(),await a(t,[t.correctRow,t.correctCol]),t.markFrezee()}for(let o=v.cols-1;o>1;o--){let s=function(){return n.isCorrect&&t.isCorrect};const n=w.find(T=>T.correctRow==1&&T.correctCol==o),t=w.find(T=>T.correctRow==2&&T.correctCol==o);await a(t,[n.correctRow,n.correctCol],s),t.markFrezee(),await a(n,[n.correctRow,n.correctCol-1],s)||(t.unFrezee(),await a(n,[n.correctRow,n.correctCol-2]),n.markFrezee(),t.unFrezee(),await a(t,[n.correctRow,n.correctCol]),t.markFrezee(),n.unFrezee(),await a(n,[n.correctRow,n.correctCol-1])),n.markFrezee(),t.unFrezee(),await a(t,[t.correctRow,t.correctCol]),t.markFrezee(),n.unFrezee(),await a(n,[n.correctRow,n.correctCol]),n.markFrezee()}const P=w.find(o=>o.value==2);await a(P,[P.correctRow,P.correctCol]),P.markFrezee();const g=w.find(o=>o.value==1);await a(g,[g.correctRow,g.correctCol]),g.markFrezee(),B=0,console.log(`Resolved in ${(Date.now()-S)/1e3}s`),X();function X(){var o;document.querySelector(".puzzle-resolver-target")&&((o=document.querySelector(".puzzle-resolver-target"))==null||o.classList.remove("puzzle-resolver-target"))}async function a(o,s,n){if(B!==1)throw new Error("puzzle-resolver: Invalid status");if(n&&n())return!0;d=o,o.isImage||(X(),o.getEl().classList.add("puzzle-resolver-target"));const t=W([o.row,o.col],s);if(t==c.CENTER)return console.log(`Moved ${o.value} to ${s}`),p={},!0;R.row==0&&(console.log("Move blank block down due to row == 0"),await z(e.DOWN));const O=W([R.row,R.col],[o.row,o.col]);if(i.includes(O)){if(O==c.NEXT_TO_TOP){if(k.includes(t))await z(e.DOWN);else{let[G,H]=_(E.includes(t)||o.col==0,[e.RIGTH,[e.LEFT,e.UP]],[e.LEFT,[e.RIGTH,e.UP]]);if(!await L(G,H,m))return console.log("Cannot find next step "+c.NEXT_TO_TOP),!1}return await a(o,s,n)}if(O==c.NEXT_TO_BOTTOM){if(C.includes(t))await z(e.UP);else{let[G,H]=_(E.includes(t)||o.col==0,[e.RIGTH,[e.LEFT,e.DOWN]],[e.LEFT,[e.RIGTH,e.DOWN]]);if(!await L(G,H,m))return console.log("Cannot find next step "+c.NEXT_TO_BOTTOM),!1}return await a(o,s,n)}let[f,h]=_(O==c.TOP,[e.DOWN,[e.LEFT,e.RIGTH,e.UP]],[e.UP,[e.LEFT,e.RIGTH,e.DOWN]]);return await L(f,h,m)?await a(o,s,n):(console.log("Cannot find next step SAME_COLS"),!1)}if(u.includes(O)){if(O==c.NEXT_TO_LEFT){if(F.includes(t))await z(e.RIGTH);else{let[G,H]=_(C.includes(t)||o.row==1,[e.DOWN,[e.UP,e.LEFT]],[e.UP,[e.DOWN,e.LEFT]]);if(!await L(G,H,m))return console.log("Cannot find next step "+c.NEXT_TO_LEFT),!1}return await a(o,s,n)}if(O==c.NEXT_TO_RIGHT){if(E.includes(t))await z(e.LEFT);else{let[G,H]=_(C.includes(t)||o.row==1,[e.DOWN,[e.UP,e.RIGTH]],[e.UP,[e.DOWN,e.RIGTH]]);if(!await L(G,H,m))return console.log("Cannot find next step "+c.NEXT_TO_RIGHT),!1}return await a(o,s,n)}let[f,h]=_(O==c.LEFT,[e.RIGTH,[e.LEFT,e.DOWN,e.UP]],[e.LEFT,[e.RIGTH,e.DOWN,e.UP]]);return await L(f,h,m)?await a(o,s,n):(console.log("Cannot find next step SAME_ROWS"),!1)}let T=null;switch(O){case c.TOP_LEFT:T=_(C.includes(t)||F.includes(t),[e.DOWN,[e.RIGTH,e.UP,e.LEFT]],[e.RIGTH,[e.DOWN,e.UP,e.LEFT]]);break;case c.TOP_RIGHT:T=_(k.includes(t)||F.includes(t),[e.LEFT,[e.DOWN,e.UP,e.RIGTH]],[e.DOWN,[e.LEFT,e.UP,e.RIGTH]]);break;case c.BOTTOM_LEFT:T=_(C.includes(t)||E.includes(t),[e.RIGTH,[e.UP,e.LEFT,e.DOWN]],[e.UP,[e.RIGTH,e.LEFT,e.DOWN]]);break;case c.BOTTOM_RIGHT:T=_(C.includes(t)||F.includes(t),[e.LEFT,[e.UP,e.RIGTH,e.DOWN]],[e.UP,[e.LEFT,e.RIGTH,e.DOWN]]);break}return!T||!await L(T[0],T[1],m)?(console.log(`Cannot find next step where ${O}`),!1):await a(o,s,n)}function _(o,s,n){return o?s:n}function m(o){d&&(p[`${d.value} - ${d.row} - ${d.col}--${o[0]} - ${o[1]}`]=!0)}async function L(o,s,n){if(await z(o))return!0;for(let t=0;t<s.length;t++){const O=s[t],T=[R.row,R.col];if(await z(O))return n(T),!0}return!1}function z(o){return new Promise(s=>{const[n,t]=x(o),O=[R.row,R.col],T=[R.row+n,R.col+t];if(!I[T[0]]||!I[T[0]][T[1]]){console.log(`Move: Not exists target ${T}`),s(!1);return}if(I[T[0]][T[1]].value==-1||I[T[0]][T[1]].frezee){console.log(`Move: -1 or frezee ${T}`),s(!1);return}if(d&&p[`${d.value} - ${d.row} - ${d.col}--${T[0]} - ${T[1]}`]){console.log(`Move: -1 or frezee ${T}`),s(!1);return}I[T[0]][T[1]].click(),setTimeout(()=>{$(I,O,T),s(!0)},l)})}}function W([r,l],[i,u]){return r==i?l==u?c.CENTER:Math.abs(l-u)==1?l-u==-1?c.NEXT_TO_LEFT:c.NEXT_TO_RIGHT:l<u?c.LEFT:c.RIGHT:r<i?l==u?r-i==-1?c.NEXT_TO_TOP:c.TOP:l<u?c.TOP_LEFT:c.TOP_RIGHT:l==u?r-i==1?c.NEXT_TO_BOTTOM:c.BOTTOM:l<u?c.BOTTOM_LEFT:c.BOTTOM_RIGHT}function $(r,[l,i],[u,E]){const F=r[u][E];r[u][E]=r[l][i],r[l][i]=F}function x(r){switch(r){case e.UP:return[-1,0];case e.DOWN:return[1,0];case e.LEFT:return[0,-1];case e.RIGTH:return[0,1]}}function A(r){const l=[];let i=document.createElement("div");for(let u=0;u<r.rows;u++){let E=[];for(let F=0;F<r.cols;F++)E.push(M.fromEl(i));l.push(E)}return l}var e=(r=>(r[r.UP=0]="UP",r[r.DOWN=1]="DOWN",r[r.LEFT=2]="LEFT",r[r.RIGTH=3]="RIGTH",r))(e||{}),c=(r=>(r.TOP="TOP",r.RIGHT="RIGHT",r.BOTTOM="BOTTOM",r.LEFT="LEFT",r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r.CENTER="CENTER",r.NEXT_TO_LEFT="NEXT_TO_LEFT",r.NEXT_TO_RIGHT="NEXT_TO_RIGHT",r.NEXT_TO_TOP="NEXT_TO_TOP",r.NEXT_TO_BOTTOM="NEXT_TO_BOTTOM",r))(c||{});class b{constructor(l,i){N(this,"rows");N(this,"cols");this.rows=l,this.cols=i}}class M{constructor(l){N(this,"el");N(this,"val");N(this,"cRow");N(this,"cCol");N(this,"isFrezee");this.el=l,this.cRow=-1,this.cCol=-1,this.val=parseInt(this.el.dataset.value||"-1"),this.isFrezee=!1}getEl(){return this.el}click(){this.el.click()}static fromEl(l){return new M(l)}markFrezee(){this.isFrezee=!0}unFrezee(){this.isFrezee=!1}setCorrectPosition(l,i){this.cRow=l,this.cCol=i}get row(){return parseInt(this.el.dataset.currentRow)}get col(){return parseInt(this.el.dataset.currentCol)}get value(){return this.val}get frezee(){return this.isFrezee}get correctRow(){return this.cRow}get correctCol(){return this.cCol}get isCorrect(){return this.row===this.cRow&&this.col===this.cCol}get isImage(){return this.el.classList.contains("block-mode-image")}}function q(r,l){return r==0?[0,0]:[r%l==0?r/l:Math.floor(r/l)+1,r%l==0?l-1:r%l-1]}export{V as resolve};
