var W=Object.defineProperty;var y=(r,T,s)=>T in r?W(r,T,{enumerable:!0,configurable:!0,writable:!0,value:s}):r[T]=s;var P=(r,T,s)=>(y(r,typeof T!="symbol"?T+"":T,s),s);let H="IDLE";if(!document.getElementById("puzzle-resolver-style")&&location.href.includes("auto_resolve_highlight=1")){const r=document.createElement("style");r.id="puzzle-resolver-style",r.innerText=".puzzle-resolver-target {background-color:#5daef4!important}",document.head.appendChild(r)}async function Y(r){if(H=="RUNNING"){console.log("Stopped. An error will throw soon."),H="IDLE";return}H="RUNNING";const T=isNaN(Number(r))?500:Number(r),s=[c.TOP,c.NEXT_TO_TOP,c.CENTER,c.NEXT_TO_BOTTOM,c.BOTTOM],u=[c.LEFT,c.NEXT_TO_LEFT,c.CENTER,c.NEXT_TO_RIGHT,c.RIGHT],_=[c.TOP_LEFT,c.NEXT_TO_LEFT,c.LEFT,c.BOTTOM_LEFT],I=[c.TOP_RIGHT,c.NEXT_TO_RIGHT,c.RIGHT,c.BOTTOM_RIGHT],z=[c.TOP_LEFT,c.NEXT_TO_TOP,c.TOP,c.TOP_RIGHT],B=[c.BOTTOM_LEFT,c.NEXT_TO_BOTTOM,c.BOTTOM,c.BOTTOM_RIGHT],v=document.querySelector(".game-container"),h=new q(parseInt(v.dataset.rows)+1,parseInt(v.dataset.cols)),d=x(h),w=Array.from(document.querySelectorAll(".block:not(.wall)")).map(n=>g.fromEl(n));if(w.forEach(n=>{const[i,t]=j(n.value,h.cols);n.setCorrectPosition(i,t),d[n.row][n.col]=n}),w.filter(n=>!n.isCorrect).length==0){console.log("All block is correct. Stop."),H="IDLE";return}let X=Date.now();console.clear(),console.log("Resolving...");const L=w.find(n=>n.value==0);let N=null,M={};for(let n=h.rows-1;n>2;n--){let i=function(){return t.isCorrect&&o.isCorrect};for(let l=h.cols-1;l>=2;l--){const f=w.find(F=>F.correctRow==n&&F.correctCol==l);console.log(`Moving ${f.value} to ${[f.correctRow,f.correctCol]}`),await E(f,[f.correctRow,f.correctCol]),f.markFrezee()}const t=w.find(l=>l.correctRow==n&&l.correctCol==0),o=w.find(l=>l.correctRow==n&&l.correctCol==1);await E(t,[o.correctRow,o.correctCol],i),t.markFrezee(),await E(o,[o.correctRow-1,o.correctCol],i)||(t.unFrezee(),await E(o,[o.correctRow-2,o.correctCol]),o.markFrezee(),await E(t,[o.correctRow,o.correctCol]),t.markFrezee(),o.unFrezee(),await E(o,[o.correctRow-1,o.correctCol])),o.markFrezee(),t.unFrezee(),await E(t,[t.correctRow,t.correctCol]),t.markFrezee(),o.unFrezee(),await E(o,[o.correctRow,o.correctCol]),o.markFrezee()}for(let n=h.cols-1;n>1;n--){let i=function(){return t.isCorrect&&o.isCorrect};const t=w.find(l=>l.correctRow==1&&l.correctCol==n),o=w.find(l=>l.correctRow==2&&l.correctCol==n);await E(o,[t.correctRow,t.correctCol],i),o.markFrezee(),await E(t,[t.correctRow,t.correctCol-1],i)||(o.unFrezee(),await E(t,[t.correctRow,t.correctCol-2]),t.markFrezee(),o.unFrezee(),await E(o,[t.correctRow,t.correctCol]),o.markFrezee(),t.unFrezee(),await E(t,[t.correctRow,t.correctCol-1])),t.markFrezee(),o.unFrezee(),await E(o,[o.correctRow,o.correctCol]),o.markFrezee(),t.unFrezee(),await E(t,[t.correctRow,t.correctCol]),t.markFrezee()}const k=w.find(n=>n.value==2);await E(k,[k.correctRow,k.correctCol]),k.markFrezee();const p=w.find(n=>n.value==1);await E(p,[p.correctRow,p.correctCol]),p.markFrezee(),H="IDLE",console.log(`Resolved in ${(Date.now()-X)/1e3}s`),A();async function E(n,i,t){let o=a.STEPPED;do{if(t&&t()){o=a.COMPLETED;break}N=n,o=await U(n,i)}while(o==a.STEPPED);return M={},o==a.COMPLETED}async function U(n,i){if(H!=="RUNNING")throw new Error("puzzle-resolver: Invalid status");const t=S([n.row,n.col],i);if(t==c.CENTER)return a.COMPLETED;L.row==0&&(console.log("Move blank block down due to row == 0"),await C(e.DOWN));const o=S([L.row,L.col],[n.row,n.col]);if(s.includes(o)){if(o==c.NEXT_TO_TOP){if(B.includes(t))await C(e.DOWN);else{let[F,G]=R(_.includes(t)||n.col==0,[e.RIGTH,[e.LEFT,e.UP]],[e.LEFT,[e.RIGTH,e.UP]]);if(!await m(F,G,D))return console.log("Cannot find next step "+c.NEXT_TO_TOP),a.FAILED}return a.STEPPED}if(o==c.NEXT_TO_BOTTOM){if(z.includes(t))await C(e.UP);else{let[F,G]=R(_.includes(t)||n.col==0,[e.RIGTH,[e.LEFT,e.DOWN]],[e.LEFT,[e.RIGTH,e.DOWN]]);if(!await m(F,G,D))return console.log("Cannot find next step "+c.NEXT_TO_BOTTOM),a.FAILED}return a.STEPPED}let[l,f]=R(o==c.TOP,[e.DOWN,[e.LEFT,e.RIGTH,e.UP]],[e.UP,[e.LEFT,e.RIGTH,e.DOWN]]);return await m(l,f,D)?a.STEPPED:(console.log("Cannot find next step SAME_COLS"),a.FAILED)}if(u.includes(o)){if(o==c.NEXT_TO_LEFT){if(I.includes(t))await C(e.RIGTH);else{let[F,G]=R(z.includes(t)||n.row==1,[e.DOWN,[e.UP,e.LEFT]],[e.UP,[e.DOWN,e.LEFT]]);if(!await m(F,G,D))return console.log("Cannot find next step "+c.NEXT_TO_LEFT),a.FAILED}return a.STEPPED}if(o==c.NEXT_TO_RIGHT){if(_.includes(t))await C(e.LEFT);else{let[F,G]=R(z.includes(t)||n.row==1,[e.DOWN,[e.UP,e.RIGTH]],[e.UP,[e.DOWN,e.RIGTH]]);if(!await m(F,G,D))return console.log("Cannot find next step "+c.NEXT_TO_RIGHT),a.FAILED}return a.STEPPED}let[l,f]=R(o==c.LEFT,[e.RIGTH,[e.LEFT,e.DOWN,e.UP]],[e.LEFT,[e.RIGTH,e.DOWN,e.UP]]);return await m(l,f,D)?a.STEPPED:(console.log("Cannot find next step SAME_ROWS"),a.FAILED)}let O=null;switch(o){case c.TOP_LEFT:O=R(z.includes(t)||I.includes(t),[e.DOWN,[e.RIGTH,e.UP,e.LEFT]],[e.RIGTH,[e.DOWN,e.UP,e.LEFT]]);break;case c.TOP_RIGHT:O=R(B.includes(t)||I.includes(t),[e.LEFT,[e.DOWN,e.UP,e.RIGTH]],[e.DOWN,[e.LEFT,e.UP,e.RIGTH]]);break;case c.BOTTOM_LEFT:O=R(z.includes(t)||_.includes(t),[e.RIGTH,[e.UP,e.LEFT,e.DOWN]],[e.UP,[e.RIGTH,e.LEFT,e.DOWN]]);break;case c.BOTTOM_RIGHT:O=R(z.includes(t)||I.includes(t),[e.LEFT,[e.UP,e.RIGTH,e.DOWN]],[e.UP,[e.LEFT,e.RIGTH,e.DOWN]]);break}return!O||!await m(O[0],O[1],D)?(console.log(`Cannot find next step where ${o}`),a.FAILED):a.STEPPED}function D(n){N&&(M[`${N.value} - ${N.row} - ${N.col}--${n[0]} - ${n[1]}`]=!0)}async function m(n,i,t){if(await C(n))return!0;for(let o=0;o<i.length;o++){const O=i[o],l=[L.row,L.col];if(await C(O))return t(l),!0}return!1}function C(n){return new Promise(i=>{const[t,o]=b(n),O=[L.row,L.col],l=[L.row+t,L.col+o];if(!d[l[0]]||!d[l[0]][l[1]]){console.log(`Move: Not exists target ${l}`),i(!1);return}if(d[l[0]][l[1]].value==-1||d[l[0]][l[1]].frezee){console.log(`Move: -1 or frezee ${l}`),i(!1);return}if(N&&M[`${N.value} - ${N.row} - ${N.col}--${l[0]} - ${l[1]}`]){console.log(`Move: -1 or frezee ${l}`),i(!1);return}d[l[0]][l[1]].click(),setTimeout(()=>{$(d,O,l),i(!0)},T)})}}function A(){var r;document.querySelector(".puzzle-resolver-target")&&((r=document.querySelector(".puzzle-resolver-target"))==null||r.classList.remove("puzzle-resolver-target"))}function S([r,T],[s,u]){return r==s?T==u?c.CENTER:Math.abs(T-u)==1?T-u==-1?c.NEXT_TO_LEFT:c.NEXT_TO_RIGHT:T<u?c.LEFT:c.RIGHT:r<s?T==u?r-s==-1?c.NEXT_TO_TOP:c.TOP:T<u?c.TOP_LEFT:c.TOP_RIGHT:T==u?r-s==1?c.NEXT_TO_BOTTOM:c.BOTTOM:T<u?c.BOTTOM_LEFT:c.BOTTOM_RIGHT}function R(r,T,s){return r?T:s}function b(r){switch(r){case e.UP:return[-1,0];case e.DOWN:return[1,0];case e.LEFT:return[0,-1];case e.RIGTH:return[0,1]}}function $(r,[T,s],[u,_]){const I=r[u][_];r[u][_]=r[T][s],r[T][s]=I}function x(r){const T=[];let s=document.createElement("div");for(let u=0;u<r.rows;u++){let _=[];for(let I=0;I<r.cols;I++)_.push(g.fromEl(s));T.push(_)}return T}var e=(r=>(r[r.UP=0]="UP",r[r.DOWN=1]="DOWN",r[r.LEFT=2]="LEFT",r[r.RIGTH=3]="RIGTH",r))(e||{}),a=(r=>(r.COMPLETED="COMPLETED",r.FAILED="FAILED",r.STEPPED="STEPPED",r))(a||{}),c=(r=>(r.TOP="TOP",r.RIGHT="RIGHT",r.BOTTOM="BOTTOM",r.LEFT="LEFT",r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r.CENTER="CENTER",r.NEXT_TO_LEFT="NEXT_TO_LEFT",r.NEXT_TO_RIGHT="NEXT_TO_RIGHT",r.NEXT_TO_TOP="NEXT_TO_TOP",r.NEXT_TO_BOTTOM="NEXT_TO_BOTTOM",r))(c||{});class q{constructor(T,s){P(this,"rows");P(this,"cols");this.rows=T,this.cols=s}}class g{constructor(T){P(this,"el");P(this,"val");P(this,"cRow");P(this,"cCol");P(this,"isFrezee");this.el=T,this.cRow=-1,this.cCol=-1,this.val=parseInt(this.el.dataset.value||"-1"),this.isFrezee=!1}getEl(){return this.el}click(){this.el.click()}static fromEl(T){return new g(T)}markFrezee(){this.isFrezee=!0}unFrezee(){this.isFrezee=!1}setCorrectPosition(T,s){this.cRow=T,this.cCol=s}get row(){return parseInt(this.el.dataset.currentRow)}get col(){return parseInt(this.el.dataset.currentCol)}get value(){return this.val}get frezee(){return this.isFrezee}get correctRow(){return this.cRow}get correctCol(){return this.cCol}get isCorrect(){return this.row===this.cRow&&this.col===this.cCol}get isImage(){return this.el.classList.contains("block-mode-image")}}function j(r,T){return r==0?[0,0]:[r%T==0?r/T:Math.floor(r/T)+1,r%T==0?T-1:r%T-1]}export{Y as resolve};
